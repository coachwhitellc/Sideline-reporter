<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sideline Reporter - Hybrid AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            padding: 20px;
        }

        .section {
            margin-bottom: 30px;
            background: #f8f9ff;
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e1e8ff;
        }

        .section h2 {
            font-size: 18px;
            color: #1e3c72;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sport-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .sport-btn {
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .sport-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sport-btn:hover {
            border-color: #667eea;
        }

        .recording-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .recording-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .record-btn, .transcribe-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .record-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .transcribe-btn {
            background: linear-gradient(135deg, #10ac84, #00d2d3);
            color: white;
        }

        .record-btn:disabled, .transcribe-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .record-btn.recording {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        .timer {
            font-size: 18px;
            font-weight: 600;
            color: #1e3c72;
            font-family: 'Courier New', monospace;
            text-align: center;
        }

        .audio-player {
            width: 100%;
            margin: 10px 0;
        }

        .transcription-area {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            margin-top: 10px;
        }

        .transcription-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: center;
            padding: 8px;
            background: #f8f9ff;
            border-radius: 6px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e3c72;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .guided-questions {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .guided-questions h4 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .guided-questions ul {
            list-style: none;
            padding: 0;
        }

        .guided-questions li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            color: #666;
        }

        .guided-questions li:last-child {
            border-bottom: none;
        }

        .photo-upload {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .photo-upload:hover {
            border-color: #5a6fd8;
            background: #f8f9ff;
        }

        #photoInput {
            display: none;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            color: #ff4757;
            font-weight: bold;
        }

        .photo-item .caption-input {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 5px;
            font-size: 11px;
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #10ac84, #00d2d3);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 172, 132, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 172, 132, 0.4);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .article-output {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .article-output h3 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .article-content {
            line-height: 1.6;
            color: #333;
        }

        .article-content h1 {
            font-size: 24px;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .article-content h2 {
            font-size: 20px;
            color: #2a5298;
            margin: 20px 0 10px 0;
        }

        .article-content p {
            margin-bottom: 15px;
        }

        .article-content blockquote {
            border-left: 4px solid #667eea;
            margin: 15px 0;
            padding: 10px 15px;
            background: #f8f9ff;
            font-style: italic;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
        }

        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }

        .status-ready {
            background: #d1f2eb;
            color: #00695c;
        }

        .status-missing {
            background: #fff3e0;
            color: #e65100;
        }

        .ai-suggestions {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .ai-suggestions h4 {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .ai-suggestions p {
            font-size: 13px;
            line-height: 1.4;
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📰 Sideline Reporter</h1>
            <p>Smart templates + Real speech-to-text</p>
        </div>

        <div class="main-content">
            <!-- Sport Selection -->
            <div class="section">
                <h2><span>🏆</span> Choose Sport</h2>
                <div class="sport-selector">
                    <button class="sport-btn active" data-sport="general">📰 General</button>
                    <button class="sport-btn" data-sport="football">🏈 Football</button>
                    <button class="sport-btn" data-sport="basketball">🏀 Basketball</button>
                    <button class="sport-btn" data-sport="soccer">⚽ Soccer</button>
                    <button class="sport-btn" data-sport="baseball">⚾ Baseball</button>
                    <button class="sport-btn" data-sport="volleyball">🏐 Volleyball</button>
                    <button class="sport-btn" data-sport="track">🏃 Track & Field</button>
                </div>
            </div>

            <!-- Smart Recording with Transcription -->
            <div class="section">
                <h2><span>🎤</span> Smart Interview Recording</h2>
                <div class="recording-section">
                    <div class="recording-controls">
                        <button id="recordBtn" class="record-btn">🔴 Start Recording</button>
                        <button id="transcribeBtn" class="transcribe-btn">📝 Start Transcribing</button>
                    </div>
                    <div id="timer" class="timer">00:00</div>
                    <div id="audioContainer"></div>
                    <textarea id="transcriptionArea" class="transcription-area" placeholder="Audio transcription will appear here... You can also type or edit the text directly."></textarea>
                    <div id="transcriptionStatus" class="transcription-status"></div>
                </div>
                
                <div id="guidedQuestions" class="guided-questions">
                    <h4>💡 Suggested Interview Questions for General:</h4>
                    <ul id="questionsList">
                        <li>Can you tell us about this event/story?</li>
                        <li>What happened here today?</li>
                        <li>How do you feel about what occurred?</li>
                        <li>What's the most important thing people should know?</li>
                        <li>What happens next?</li>
                    </ul>
                </div>
            </div>

            <!-- Enhanced Story Details -->
            <div class="section">
                <h2><span>📝</span> Smart Story Builder</h2>
                <div class="input-group">
                    <label for="eventTitle">Story Title</label>
                    <input type="text" id="eventTitle" placeholder="e.g., New Library Opens Downtown, Student Wins Scholarship, etc.">
                </div>
                
                <div class="input-group">
                    <label for="gameScore">Key Details/Results</label>
                    <input type="text" id="gameScore" placeholder="e.g., Opening ceremony at 2pm, $5000 scholarship awarded, etc.">
                </div>
                
                <div class="input-group">
                    <label for="keyPlayers">Key People</label>
                    <input type="text" id="keyPlayers" placeholder="e.g., Principal Smith, Student Jane Doe, Coach Johnson">
                </div>
                
                <div class="input-group">
                    <label for="gameHighlights">Main Points/Highlights</label>
                    <textarea id="gameHighlights" placeholder="Describe the most important aspects of this story..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="additionalNotes">Additional Context</label>
                    <textarea id="additionalNotes" placeholder="Background information, quotes, atmosphere, significance..."></textarea>
                </div>

                <div id="aiSuggestions" class="ai-suggestions" style="display: none;">
                    <h4>🤖 Smart Suggestions</h4>
                    <p id="suggestionText"></p>
                </div>
            </div>

            <!-- Enhanced Photo Section -->
            <div class="section">
                <h2><span>📸</span> Photo Gallery with Captions</h2>
                <div class="photo-upload" id="photoUpload">
                    <div style="font-size: 48px; margin-bottom: 10px;">📷</div>
                    <p><strong>Add Game Photos</strong></p>
                    <p>Tap to select or drag and drop</p>
                </div>
                <input type="file" id="photoInput" accept="image/*" multiple>
                <div id="photoGrid" class="photo-grid"></div>
            </div>

            <!-- Generate Article -->
            <button id="generateBtn" class="generate-btn">
                ✨ Generate Smart Article
            </button>

            <div id="statusIndicator" class="status-indicator status-missing">
                📋 Choose sport and add content to generate article
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Creating your intelligent article...</p>
            </div>

            <div id="articleOutput" class="article-output">
                <h3>📄 Your Generated Article</h3>
                <div id="articleContent" class="article-content"></div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button id="copyBtn" class="copy-btn">📋 Copy Article</button>
                    <button id="emailBtn" class="copy-btn" style="background: #e74c3c;">📧 Email Article</button>
                    <button id="driveBtn" class="copy-btn" style="background: #4285f4;">💾 Save to Drive</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class HybridSidelineReporter {
            constructor() {
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.startTime = 0;
                this.timerInterval = null;
                this.audioBlob = null;
                this.photos = [];
                this.selectedSport = 'general';
                this.recognition = null;
                this.isTranscribing = false;
                
                this.sportQuestions = {
                    general: [
                        "Can you tell us about this event/story?",
                        "What happened here today?",
                        "How do you feel about what occurred?",
                        "What's the most important thing people should know?",
                        "What happens next?"
                    ],
                    football: [
                        "How do you feel about your team's performance tonight?",
                        "What was the key moment that changed the game?",
                        "Can you walk us through that winning play?",
                        "How did your team prepare for this opponent?",
                        "What's next for your team this season?"
                    ],
                    basketball: [
                        "How did your shooting feel tonight?",
                        "What was your strategy against their defense?",
                        "Tell us about that clutch shot in the fourth quarter",
                        "How important was rebounding in tonight's win?",
                        "What adjustments did you make at halftime?"
                    ],
                    soccer: [
                        "How did it feel to score the winning goal?",
                        "What was your game plan against this opponent?",
                        "Tell us about the team's passing strategy",
                        "How crucial was possession in this match?",
                        "What does this victory mean for your season?"
                    ],
                    baseball: [
                        "Walk us through that winning hit",
                        "How did you approach that at-bat?",
                        "What was working for you on the mound today?",
                        "How important was defense in tonight's game?",
                        "What's the team's momentum heading into next game?"
                    ],
                    volleyball: [
                        "Tell us about that amazing rally",
                        "How did your team communicate during the match?",
                        "What was your serving strategy?",
                        "How did you read the opponent's attacks?",
                        "What adjustments led to the comeback?"
                    ],
                    track: [
                        "How did you prepare for this race?",
                        "What was going through your mind at the finish?",
                        "Tell us about your training for this event",
                        "How did the weather conditions affect your performance?",
                        "What are your goals for the rest of the season?"
                    ]
                };
                
                this.initializeElements();
                this.bindEvents();
                this.initializeSpeechRecognition();
                this.updateGuidedQuestions();
                this.updateStatus();
            }

            initializeElements() {
                this.recordBtn = document.getElementById('recordBtn');
                this.transcribeBtn = document.getElementById('transcribeBtn');
                this.timer = document.getElementById('timer');
                this.audioContainer = document.getElementById('audioContainer');
                this.transcriptionArea = document.getElementById('transcriptionArea');
                this.transcriptionStatus = document.getElementById('transcriptionStatus');
                this.photoUpload = document.getElementById('photoUpload');
                this.photoInput = document.getElementById('photoInput');
                this.photoGrid = document.getElementById('photoGrid');
                this.generateBtn = document.getElementById('generateBtn');
                this.loading = document.getElementById('loading');
                this.articleOutput = document.getElementById('articleOutput');
                this.articleContent = document.getElementById('articleContent');
                this.copyBtn = document.getElementById('copyBtn');
                this.emailBtn = document.getElementById('emailBtn');
                this.driveBtn = document.getElementById('driveBtn');
                this.eventTitle = document.getElementById('eventTitle');
                this.gameScore = document.getElementById('gameScore');
                this.keyPlayers = document.getElementById('keyPlayers');
                this.gameHighlights = document.getElementById('gameHighlights');
                this.additionalNotes = document.getElementById('additionalNotes');
                this.statusIndicator = document.getElementById('statusIndicator');
                this.aiSuggestions = document.getElementById('aiSuggestions');
                this.suggestionText = document.getElementById('suggestionText');
                this.questionsList = document.getElementById('questionsList');
            }

            bindEvents() {
                // Sport selection
                document.querySelectorAll('.sport-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.selectSport(e.target.dataset.sport));
                });

                // Recording controls
                this.recordBtn.addEventListener('click', () => this.toggleRecording());
                this.transcribeBtn.addEventListener('click', () => this.toggleTranscription());

                // Photo handling
                this.photoUpload.addEventListener('click', () => this.photoInput.click());
                this.photoInput.addEventListener('change', (e) => this.handlePhotoSelect(e));

                // Article generation
                this.generateBtn.addEventListener('click', () => this.generateSmartArticle());
                this.copyBtn.addEventListener('click', () => this.copyArticle());
                this.emailBtn.addEventListener('click', () => this.emailArticle());
                this.driveBtn.addEventListener('click', () => this.saveToGoogleDrive());

                // Smart suggestions
                this.eventTitle.addEventListener('input', () => this.provideSuggestions());
                this.keyPlayers.addEventListener('input', () => this.updateStatus());
                this.gameScore.addEventListener('input', () => this.updateStatus());
                this.gameHighlights.addEventListener('input', () => this.updateStatus());
                this.additionalNotes.addEventListener('input', () => this.updateStatus());
                this.transcriptionArea.addEventListener('input', () => this.updateStatus());

                // Drag and drop
                this.photoUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.photoUpload.style.background = '#f0f3ff';
                });
                
                this.photoUpload.addEventListener('dragleave', () => {
                    this.photoUpload.style.background = 'white';
                });
                
                this.photoUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.photoUpload.style.background = 'white';
                    this.handlePhotoSelect({ target: { files: e.dataTransfer.files } });
                });
            }

            initializeSpeechRecognition() {
                // Check if speech recognition is available
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    // Configure for better accuracy
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'en-US';
                    this.recognition.maxAlternatives = 1;

                    this.recognition.onstart = () => {
                        this.transcriptionStatus.textContent = '🎤 Listening... Speak now!';
                        this.transcribeBtn.textContent = '⏹️ Stop Transcribing';
                        this.transcribeBtn.style.background = 'linear-gradient(135deg, #ff4757, #ff3838)';
                    };

                    this.recognition.onresult = (event) => {
                        let finalTranscript = '';
                        let interimTranscript = '';

                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const transcript = event.results[i][0].transcript;
                            if (event.results[i].isFinal) {
                                finalTranscript += transcript + ' ';
                            } else {
                                interimTranscript += transcript;
                            }
                        }

                        // Add final transcript to the text area
                        if (finalTranscript) {
                            const currentText = this.transcriptionArea.value;
                            this.transcriptionArea.value = currentText + finalTranscript;
                            this.updateStatus();
                        }
                        
                        // Show what's being heard in real-time
                        if (interimTranscript) {
                            this.transcriptionStatus.textContent = `🎤 Hearing: "${interimTranscript}"`;
                        } else {
                            this.transcriptionStatus.textContent = '🎤 Listening... Keep talking!';
                        }
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        let errorMessage = 'Error with speech recognition. ';
                        
                        switch(event.error) {
                            case 'not-allowed':
                                errorMessage = 'Microphone access denied. Please allow microphone access and try again.';
                                break;
                            case 'no-speech':
                                errorMessage = 'No speech detected. Try speaking louder or closer to the microphone.';
                                break;
                            case 'network':
                                errorMessage = 'Network error. Check your internet connection.';
                                break;
                            default:
                                errorMessage = `Recognition error: ${event.error}. Try again.`;
                        }
                        
                        this.transcriptionStatus.textContent = errorMessage;
                        this.stopTranscription();
                    };

                    this.recognition.onend = () => {
                        if (this.isTranscribing) {
                            // Restart if we're still supposed to be transcribing
                            try {
                                this.recognition.start();
                            } catch (error) {
                                this.stopTranscription();
                            }
                        }
                    };
                    
                    this.transcriptionStatus.textContent = 'Speech recognition ready. Click "Start Transcribing" to begin.';
                } else {
                    this.transcriptionStatus.textContent = 'Speech recognition not supported. Please use Safari browser on iPhone for best results.';
                    this.transcribeBtn.disabled = true;
                }
            }

            selectSport(sport) {
                document.querySelectorAll('.sport-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-sport="${sport}"]`).classList.add('active');
                this.selectedSport = sport;
                this.updateGuidedQuestions();
                this.updateStatus();
            }

            updateGuidedQuestions() {
                const questions = this.sportQuestions[this.selectedSport] || this.sportQuestions.general;
                const sportName = this.selectedSport === 'general' ? 'General' : 
                                 this.selectedSport.charAt(0).toUpperCase() + this.selectedSport.slice(1);
                
                document.querySelector('#guidedQuestions h4').textContent = `💡 Suggested Interview Questions for ${sportName}:`;
                
                this.questionsList.innerHTML = '';
                questions.forEach(question => {
                    const li = document.createElement('li');
                    li.textContent = question;
                    this.questionsList.appendChild(li);
                });
            }

            async toggleRecording() {
                if (!this.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            }

            async startRecording() {
                try {
                    // Request specific audio constraints for better iPhone compatibility
                    const constraints = {
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        }
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    
                    // Use supported MIME type for iPhone
                    let mimeType = 'audio/webm;codecs=opus';
                    if (!MediaRecorder.isTypeSupported(mimeType)) {
                        mimeType = 'audio/mp4';
                        if (!MediaRecorder.isTypeSupported(mimeType)) {
                            mimeType = 'audio/webm';
                            if (!MediaRecorder.isTypeSupported(mimeType)) {
                                mimeType = ''; // Let browser choose
                            }
                        }
                    }
                    
                    const options = mimeType ? { mimeType } : {};
                    this.mediaRecorder = new MediaRecorder(stream, options);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        // Use the same MIME type for blob creation
                        this.audioBlob = new Blob(this.audioChunks, { type: mimeType || 'audio/webm' });
                        this.createAudioPlayer();
                        this.updateStatus();
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.startTime = Date.now();
                    this.startTimer();
                    
                    this.recordBtn.classList.add('recording');
                    this.recordBtn.textContent = '⏹️ Stop Recording';
                    
                } catch (error) {
                    console.error('Recording error:', error);
                    alert('Error accessing microphone. Please ensure you have granted microphone permissions and try again.');
                }
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    this.isRecording = false;
                    this.stopTimer();
                    
                    this.recordBtn.classList.remove('recording');
                    this.recordBtn.textContent = '🎤 Record Again';
                }
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    const elapsed = Date.now() - this.startTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    this.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
            }

            createAudioPlayer() {
                this.audioContainer.innerHTML = '';
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.className = 'audio-player';
                audio.preload = 'auto';
                
                // Create object URL and handle cleanup
                const audioURL = URL.createObjectURL(this.audioBlob);
                audio.src = audioURL;
                
                // Add iPhone-specific attributes for better compatibility
                audio.setAttribute('webkit-playsinline', 'true');
                audio.setAttribute('playsinline', 'true');
                
                // Handle load errors
                audio.onerror = (e) => {
                    console.log('Audio error:', e);
                    // Try creating with different mime type
                    this.createFallbackAudioPlayer();
                };
                
                // Cleanup URL when audio is removed
                audio.addEventListener('loadstart', () => {
                    setTimeout(() => URL.revokeObjectURL(audioURL), 1000);
                });
                
                this.audioContainer.appendChild(audio);
                
                // Force load the audio
                audio.load();
                
                // Add transcription instructions after audio player
                const instructions = document.createElement('div');
                instructions.style.fontSize = '12px';
                instructions.style.color = '#666';
                instructions.style.textAlign = 'center';
                instructions.style.marginTop = '10px';
                instructions.style.padding = '10px';
                instructions.style.background = '#f0f8ff';
                instructions.style.borderRadius = '6px';
                instructions.innerHTML = `
                    <strong>💡 To transcribe this recording:</strong><br>
                    1. Play the audio above<br>
                    2. Click "📝 Start Transcribing" below<br>
                    3. Listen and repeat what you hear into your phone<br>
                    4. The app will convert your speech to text
                `;
                this.audioContainer.appendChild(instructions);
            }

            createFallbackAudioPlayer() {
                // Fallback method for iPhone compatibility
                this.audioContainer.innerHTML = '';
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.className = 'audio-player';
                audio.preload = 'auto';
                
                // Try different blob type for iPhone
                const fallbackBlob = new Blob(this.audioChunks, { type: 'audio/mpeg' });
                const audioURL = URL.createObjectURL(fallbackBlob);
                audio.src = audioURL;
                
                audio.setAttribute('webkit-playsinline', 'true');
                audio.setAttribute('playsinline', 'true');
                
                this.audioContainer.appendChild(audio);
                audio.load();
                
                // Add transcription instructions after audio player
                const instructions = document.createElement('div');
                instructions.style.fontSize = '12px';
                instructions.style.color = '#666';
                instructions.style.textAlign = 'center';
                instructions.style.marginTop = '10px';
                instructions.style.padding = '10px';
                instructions.style.background = '#f0f8ff';
                instructions.style.borderRadius = '6px';
                instructions.innerHTML = `
                    <strong>💡 To transcribe this recording:</strong><br>
                    1. Play the audio above<br>
                    2. Click "📝 Start Transcribing" below<br>
                    3. Listen and repeat what you hear into your phone<br>
                    4. The app will convert your speech to text
                `;
                this.audioContainer.appendChild(instructions);
            }

            toggleTranscription() {
                if (!this.recognition) {
                    alert('Speech recognition not available. Please use Safari browser on iPhone for transcription features.');
                    return;
                }

                if (this.isTranscribing) {
                    this.stopTranscription();
                } else {
                    this.startTranscription();
                }
            }

            startTranscription() {
                if (!this.recognition) return;

                try {
                    this.isTranscribing = true;
                    this.recognition.start();
                } catch (error) {
                    console.error('Failed to start transcription:', error);
                    this.transcriptionStatus.textContent = 'Failed to start transcription. Make sure microphone access is allowed.';
                    this.isTranscribing = false;
                }
            }

            stopTranscription() {
                if (this.recognition && this.isTranscribing) {
                    this.recognition.stop();
                }
                this.isTranscribing = false;
                this.transcribeBtn.textContent = '📝 Start Transcribing';
                this.transcribeBtn.style.background = 'linear-gradient(135deg, #10ac84, #00d2d3)';
                this.transcriptionStatus.textContent = 'Transcription stopped. Click "Start Transcribing" to continue.';
            }

            handlePhotoSelect(event) {
                const files = Array.from(event.target.files);
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.photos.push({
                                file: file,
                                dataUrl: e.target.result,
                                name: file.name,
                                caption: ''
                            });
                            this.updatePhotoGrid();
                            this.updateStatus();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            updatePhotoGrid() {
                this.photoGrid.innerHTML = '';
                this.photos.forEach((photo, index) => {
                    const photoItem = document.createElement('div');
                    photoItem.className = 'photo-item';
                    photoItem.innerHTML = `
                        <img src="${photo.dataUrl}" alt="${photo.name}">
                        <button class="remove-btn" onclick="app.removePhoto(${index})">×</button>
                        <input type="text" class="caption-input" placeholder="Add caption..." 
                               value="${photo.caption}" 
                               onchange="app.updatePhotoCaption(${index}, this.value)">
                    `;
                    this.photoGrid.appendChild(photoItem);
                });
            }

            removePhoto(index) {
                this.photos.splice(index, 1);
                this.updatePhotoGrid();
                this.updateStatus();
            }

            updatePhotoCaption(index, caption) {
                this.photos[index].caption = caption;
            }

            provideSuggestions() {
                const title = this.eventTitle.value.toLowerCase();
                const sport = this.selectedSport;
                
                let suggestion = '';
                
                // General content suggestions
                if (title.includes('win') || title.includes('award') || title.includes('achieve')) {
                    suggestion = `🏆 Achievement story! Include: what was won/achieved, who was involved, and why it matters.`;
                } else if (title.includes('new') || title.includes('open') || title.includes('launch')) {
                    suggestion = `🎉 New development! Focus on: what's new, who benefits, and future impact.`;
                } else if (title.includes('student') || title.includes('scholarship') || title.includes('graduate')) {
                    suggestion = `🎓 Education story! Highlight: the person's background, achievement details, and future plans.`;
                } else if (title.includes('community') || title.includes('volunteer') || title.includes('help')) {
                    suggestion = `🤝 Community story! Emphasize: the cause, people involved, and community impact.`;
                } else if (sport !== 'general' && (title.includes('championship') || title.includes('playoff'))) {
                    suggestion = `🏆 Big game! Include: stakes of the game, historical context, and emotional reactions.`;
                } else if (sport !== 'general' && (title.includes('overtime') || title.includes('ot'))) {
                    suggestion = `⏰ Overtime thriller! Focus on: tension moments, clutch plays, and player endurance.`;
                } else if (title.length > 5) {
                    suggestion = `📝 Good start! Based on your content, add specific quotes, details, and explain the significance.`;
                }
                
                if (suggestion) {
                    this.aiSuggestions.style.display = 'block';
                    this.suggestionText.textContent = suggestion;
                } else {
                    this.aiSuggestions.style.display = 'none';
                }
            }

            updateStatus() {
                const hasAudio = !!this.audioBlob;
                const hasTranscription = this.transcriptionArea.value.trim().length > 10;
                const hasPhotos = this.photos.length > 0;
                const hasTitle = this.eventTitle.value.trim().length > 0;
                const hasScore = this.gameScore.value.trim().length > 0;
                const hasPlayers = this.keyPlayers.value.trim().length > 0;
                const hasHighlights = this.gameHighlights.value.trim().length > 0;
                
                const contentCount = [hasAudio, hasTranscription, hasPhotos, hasTitle, hasScore, hasPlayers, hasHighlights].filter(Boolean).length;
                
                if (contentCount === 0) {
                    this.statusIndicator.className = 'status-indicator status-missing';
                    this.statusIndicator.textContent = '📋 Choose sport and add content to generate article';
                } else if (contentCount < 3) {
                    this.statusIndicator.className = 'status-indicator status-missing';
                    this.statusIndicator.textContent = `📝 Add more content (${contentCount}/7 sections completed)`;
                } else {
                    this.statusIndicator.className = 'status-indicator status-ready';
                    this.statusIndicator.textContent = `✅ Ready to generate! (${contentCount}/7 sections completed)`;
                }
            }

            generateSmartArticle() {
                const hasContent = this.transcriptionArea.value.trim() || this.eventTitle.value.trim() || 
                                 this.gameScore.value.trim() || this.photos.length > 0;
                
                if (!hasContent) {
                    alert('Please add some content first - record an interview, add game details, or upload photos.');
                    return;
                }

                this.loading.style.display = 'block';
                this.articleOutput.style.display = 'none';
                this.generateBtn.disabled = true;

                // Simulate processing time for a more realistic feel
                setTimeout(() => {
                    this.createIntelligentArticle();
                    this.loading.style.display = 'none';
                    this.articleOutput.style.display = 'block';
                    this.generateBtn.disabled = false;
                }, 2500);
            }

            createIntelligentArticle() {
                // Get all content
                const title = this.eventTitle.value.trim();
                const details = this.gameScore.value.trim();
                const people = this.keyPlayers.value.trim();
                const highlights = this.gameHighlights.value.trim();
                const notes = this.additionalNotes.value.trim();
                const transcription = this.transcriptionArea.value.trim();
                const sport = this.selectedSport;
                
                // PRIORITIZE INTERVIEW/TRANSCRIPTION CONTENT
                let article = '';
                let storyType = 'general';
                let mainContent = '';
                let quotesToUse = [];
                
                // If we have interview content, make it the foundation
                if (transcription && transcription.length > 20) {
                    // Analyze the transcription to determine story type and extract quotes
                    const analysisResult = this.analyzeTranscription(transcription);
                    storyType = analysisResult.storyType;
                    mainContent = analysisResult.mainContent;
                    quotesToUse = analysisResult.quotes;
                    
                    // Create headline based on interview content
                    if (!title && analysisResult.suggestedTitle) {
                        article += `<h1>${analysisResult.suggestedTitle}</h1>\n\n`;
                    } else if (title) {
                        article += `<h1>${title}</h1>\n\n`;
                    } else {
                        article += `<h1>Interview Reveals ${this.capitalizeFirst(storyType)} Story</h1>\n\n`;
                    }
                    
                    // Lead paragraph based on interview content
                    article += this.createInterviewBasedLead(analysisResult, details);
                    
                    // Main story content from interview
                    if (mainContent) {
                        article += `<h2>The Story</h2>\n`;
                        article += `<p>${mainContent}</p>\n\n`;
                    }
                    
                    // Key quotes section (primary content)
                    if (quotesToUse.length > 0) {
                        article += `<h2>Key Interview Highlights</h2>\n`;
                        quotesToUse.forEach(quote => {
                            article += `<blockquote>"${quote}"</blockquote>\n`;
                        });
                        article += `<p>These insights from our interview reveal the heart of this story.</p>\n\n`;
                    }
                    
                    // SUPPLEMENTARY sections (only if provided)
                    if (highlights && highlights.trim()) {
                        article += `<h2>Additional Details</h2>\n`;
                        article += `<p>${highlights}</p>\n\n`;
                    }
                    
                    if (people && people.trim()) {
                        article += this.createPeopleSection(storyType, people);
                    }
                    
                } else {
                    // Fallback: Use other fields if no interview content
                    const allContent = `${title} ${details} ${highlights} ${notes}`.toLowerCase();
                    storyType = this.determineStoryTypeFromFields(allContent, sport);
                    
                    if (title) {
                        article += `<h1>${title}</h1>\n\n`;
                    } else {
                        article += `<h1>Local News Story</h1>\n\n`;
                    }
                    
                    article += this.createLeadParagraph(storyType, false, details, allContent);
                    
                    if (highlights) {
                        article += this.createMainSection(storyType, highlights);
                    }
                    
                    if (people) {
                        article += this.createPeopleSection(storyType, people);
                    }
                }
                
                // Photo section (always supplementary)
                if (this.photos.length > 0) {
                    article += this.createPhotoSection(storyType);
                }
                
                // Additional context (always supplementary)
                if (notes && notes.trim()) {
                    article += `<h2>Background Information</h2>\n`;
                    article += `<p>${notes}</p>\n\n`;
                }
                
                // Conclusion based on interview insights or story type
                article += this.createConclusion(storyType, false, sport);
                
                // Attribution
                if (transcription && transcription.length > 20) {
                    article += `<p style="font-style: italic; color: #888; font-size: 12px;">This article was generated from interview transcription with supplementary reporting details.</p>`;
                } else {
                    article += `<p style="font-style: italic; color: #888; font-size: 12px;">This article was generated using intelligent content analysis and reporting templates.</p>`;
                }

                this.articleContent.innerHTML = article;
            }

            analyzeTranscription(transcription) {
                // Extract meaningful content from interview
                const sentences = transcription.split(/[.!?]+/).filter(s => s.trim().length > 15);
                const fullText = transcription.toLowerCase();
                
                let storyType = 'general';
                let suggestedTitle = '';
                let mainContent = '';
                let quotes = [];
                
                // Determine story type from actual interview content
                if (fullText.includes('win') || fullText.includes('won') || fullText.includes('victory') || fullText.includes('beat')) {
                    storyType = 'victory';
                } else if (fullText.includes('scholarship') || fullText.includes('award') || fullText.includes('honor')) {
                    storyType = 'achievement';
                } else if (fullText.includes('graduate') || fullText.includes('graduation') || fullText.includes('degree')) {
                    storyType = 'education';
                } else if (fullText.includes('open') || fullText.includes('new') || fullText.includes('launch')) {
                    storyType = 'opening';
                } else if (fullText.includes('help') || fullText.includes('volunteer') || fullText.includes('community')) {
                    storyType = 'community';
                } else if (fullText.includes('score') || fullText.includes('game') || fullText.includes('play')) {
                    storyType = 'sports';
                }
                
                // Extract best quotes (meaningful sentences)
                quotes = sentences
                    .filter(s => s.trim().length > 25 && s.trim().length < 150)
                    .slice(0, 4)
                    .map(s => s.trim());
                
                // Generate main content summary from interview
                if (sentences.length > 0) {
                    // Create a narrative from the interview content
                    const keyPoints = sentences
                        .filter(s => s.trim().length > 30)
                        .slice(0, 3);
                    
                    if (keyPoints.length > 0) {
                        mainContent = this.createNarrativeFromInterview(keyPoints, storyType);
                    }
                }
                
                // Suggest title based on interview content
                if (fullText.includes('championship') || fullText.includes('title')) {
                    suggestedTitle = 'Championship Victory Celebrated';
                } else if (fullText.includes('scholarship')) {
                    suggestedTitle = 'Local Student Receives Scholarship';
                } else if (fullText.includes('graduate')) {
                    suggestedTitle = 'Graduate Reflects on Achievement';
                } else if (storyType === 'victory') {
                    suggestedTitle = 'Victory Brings Joy and Pride';
                } else if (storyType === 'community') {
                    suggestedTitle = 'Community Effort Makes Difference';
                }
                
                return {
                    storyType,
                    suggestedTitle,
                    mainContent,
                    quotes
                };
            }

            createNarrativeFromInterview(keyPoints, storyType) {
                // Convert interview points into flowing narrative
                let narrative = '';
                
                switch(storyType) {
                    case 'victory':
                    case 'sports':
                        narrative = `The excitement was evident as details of the victory emerged. ${keyPoints[0]}. The significance of this achievement extends beyond the immediate celebration, reflecting months of preparation and dedication.`;
                        break;
                    case 'achievement':
                        narrative = `This recognition represents years of hard work and commitment. ${keyPoints[0]}. The achievement stands as an inspiration to others pursuing similar goals.`;
                        break;
                    case 'education':
                        narrative = `The educational milestone marks an important transition. ${keyPoints[0]}. This accomplishment opens new doors and opportunities for the future.`;
                        break;
                    case 'community':
                        narrative = `Community involvement has made a tangible difference. ${keyPoints[0]}. The impact of these efforts extends far beyond what was initially expected.`;
                        break;
                    default:
                        narrative = `Our interview revealed important insights about this developing story. ${keyPoints[0]}. The implications of these events continue to unfold.`;
                }
                
                return narrative;
            }

            createInterviewBasedLead(analysisResult, details) {
                let lead = '';
                const storyType = analysisResult.storyType;
                
                if (details) {
                    lead = `<p><strong>In an exclusive interview,</strong> we learned about ${details.toLowerCase()}. The conversation revealed insights that bring this story to life.</p>\n\n`;
                } else {
                    switch(storyType) {
                        case 'victory':
                        case 'sports':
                            lead = `<p><strong>Speaking with those involved,</strong> the emotion and significance of this victory became clear. The interview provided firsthand insights into what this achievement truly means.</p>\n\n`;
                            break;
                        case 'achievement':
                            lead = `<p><strong>Through our conversation,</strong> the hard work and dedication behind this achievement came to light. The interview revealed the personal journey that led to this moment.</p>\n\n`;
                            break;
                        case 'education':
                            lead = `<p><strong>Our interview highlighted</strong> the importance of this educational milestone. The conversation provided valuable perspective on the journey and what lies ahead.</p>\n\n`;
                            break;
                        case 'community':
                            lead = `<p><strong>Talking with community members</strong> revealed the true impact of these efforts. The interview showed how individual actions can create meaningful change.</p>\n\n`;
                            break;
                        default:
                            lead = `<p><strong>Our conversation provided valuable insights</strong> into this developing story. The interview revealed details that help us understand what really happened.</p>\n\n`;
                    }
                }
                
                return lead;
            }

            determineStoryTypeFromFields(allContent, sport) {
                if (sport !== 'general' && (allContent.includes('score') || allContent.includes('win'))) {
                    return 'sports';
                } else if (allContent.includes('scholarship') || allContent.includes('award')) {
                    return 'achievement';
                } else if (allContent.includes('open') || allContent.includes('new')) {
                    return 'opening';
                } else if (allContent.includes('graduate') || allContent.includes('student')) {
                    return 'education';
                } else if (allContent.includes('community') || allContent.includes('volunteer')) {
                    return 'community';
                }
                return 'general';
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            createLeadParagraph(storyType, isGameStory, details, content) {
                let lead = '';
                
                switch(storyType) {
                    case 'game':
                        if (details) {
                            lead = `<p><strong>Local teams competed</strong> in what proved to be an engaging athletic contest. ${details}</p>\n\n`;
                        } else {
                            lead = `<p>Local athletes showcased their skills in today's competitive matchup, demonstrating the dedication and talent that defines school sports.</p>\n\n`;
                        }
                        break;
                    case 'achievement':
                        lead = `<p><strong>Recognition and achievement</strong> took center stage as local individuals were honored for their outstanding accomplishments.</p>\n\n`;
                        break;
                    case 'opening':
                        lead = `<p><strong>A new chapter begins</strong> as the community welcomes an exciting addition that promises to benefit many.</p>\n\n`;
                        break;
                    case 'education':
                        lead = `<p><strong>Educational excellence</strong> continues to shine as students and educators achieve remarkable milestones.</p>\n\n`;
                        break;
                    case 'community':
                        lead = `<p><strong>Community spirit</strong> was on full display as local residents came together for a meaningful cause.</p>\n\n`;
                        break;
                    default:
                        if (details) {
                            lead = `<p><strong>Local news</strong> highlights an important story affecting our community. ${details}</p>\n\n`;
                        } else {
                            lead = `<p>A significant development in our community deserves attention and recognition.</p>\n\n`;
                        }
                }
                
                return lead;
            }

            createMainSection(storyType, highlights) {
                let section = '';
                const sectionTitle = storyType === 'game' ? 'Key Moments' : 'Highlights';
                
                section += `<h2>${sectionTitle}</h2>\n`;
                section += `<p>${highlights}</p>\n\n`;
                
                return section;
            }

            createPeopleSection(storyType, people) {
                let section = '';
                const peopleList = people.split(',').map(p => p.trim());
                
                section += `<h2>Key Individuals</h2>\n`;
                
                if (peopleList.length > 1) {
                    section += `<p>This story involves several important individuals: ${peopleList.slice(0, -1).join(', ')} and ${peopleList[peopleList.length - 1]}. Each played a crucial role in today's events.</p>\n\n`;
                } else {
                    section += `<p>${peopleList[0]} was instrumental in today's story, demonstrating leadership and commitment.</p>\n\n`;
                }
                
                return section;
            }

            createQuoteSection(transcription, storyType) {
                let section = '';
                
                section += `<h2>Interviews</h2>\n`;
                
                // Extract meaningful sentences from transcription
                const sentences = transcription.split(/[.!?]+/).filter(s => s.trim().length > 15);
                
                if (sentences.length > 0) {
                    // Use first few meaningful sentences as quotes
                    const quotes = sentences.slice(0, 3).map(s => s.trim());
                    quotes.forEach(quote => {
                        if (quote.length > 20) {
                            section += `<blockquote>"${quote}."</blockquote>\n`;
                        }
                    });
                    section += `<p>These firsthand accounts provide valuable insight into the significance and impact of today's events.</p>\n\n`;
                } else {
                    section += `<p>Interviews conducted provide valuable perspectives on the importance and impact of these events.</p>\n\n`;
                }
                
                return section;
            }

            createPhotoSection(storyType) {
                let section = '';
                
                section += `<h2>Photo Coverage</h2>\n`;
                section += `<p>Our photography captures the essence and importance of this story:</p>\n\n`;
                
                this.photos.forEach((photo, index) => {
                    const caption = photo.caption || `Image ${index + 1} from today's coverage`;
                    section += `<div style="margin: 15px 0; text-align: center;">`;
                    section += `<img src="${photo.dataUrl}" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" alt="${caption}">`;
                    section += `<p style="font-style: italic; color: #666; margin-top: 8px; font-size: 14px;">${caption}</p>`;
                    section += `</div>\n`;
                });
                
                return section;
            }

            createConclusion(storyType, isGameStory, sport) {
                let conclusion = '';
                
                conclusion += `<h2>Looking Forward</h2>\n`;
                
                switch(storyType) {
                    case 'game':
                        conclusion += `<p>Both teams demonstrated skill and sportsmanship that reflects positively on their programs and the community's support for athletics.</p>\n\n`;
                        break;
                    case 'achievement':
                        conclusion += `<p>These achievements reflect the dedication and hard work that make our community proud and inspire others to pursue excellence.</p>\n\n`;
                        break;
                    case 'opening':
                        conclusion += `<p>This new addition to our community represents progress and opportunity, promising positive impact for years to come.</p>\n\n`;
                        break;
                    case 'education':
                        conclusion += `<p>Educational achievements like these highlight the commitment to learning and growth that defines our community's values.</p>\n\n`;
                        break;
                    case 'community':
                        conclusion += `<p>Community involvement and cooperation like this demonstrate the spirit that makes our area a special place to live and work.</p>\n\n`;
                        break;
                    default:
                        conclusion += `<p>This story represents the kind of community engagement and achievement that makes our area a vibrant and thriving place.</p>\n\n`;
                }
                
                return conclusion;
            }

            getSportTerminology(sport) {
                const terms = {
                    general: {
                        victory: 'achieved success',
                        gameType: 'an important event',
                        skills: 'dedication and commitment'
                    },
                    football: {
                        victory: 'secured the victory',
                        gameType: 'a hard-fought battle',
                        skills: 'athleticism and strategic execution'
                    },
                    basketball: {
                        victory: 'claimed the win',
                        gameType: 'a fast-paced contest',
                        skills: 'shooting accuracy and defensive intensity'
                    },
                    soccer: {
                        victory: 'earned the victory',
                        gameType: 'a competitive match',
                        skills: 'ball control and tactical awareness'
                    },
                    baseball: {
                        victory: 'took the win',
                        gameType: 'a strategic game',
                        skills: 'pitching precision and batting power'
                    },
                    volleyball: {
                        victory: 'captured the victory',
                        gameType: 'an intense match',
                        skills: 'teamwork and court awareness'
                    },
                    track: {
                        victory: 'achieved victory',
                        gameType: 'a competitive meet',
                        skills: 'speed and endurance'
                    }
                };
                return terms[sport] || terms.general;
            }

            getSportConclusions(sport) {
                const conclusions = {
                    general: [
                        "This story represents the kind of community engagement that makes our area special.",
                        "Events like these highlight the positive impact individuals can have on their community.",
                        "The dedication shown here serves as an inspiration for others in our community."
                    ],
                    football: [
                        "Both teams will use tonight's experience to prepare for their upcoming conference matchups.",
                        "The coaching staff will review game film to build on tonight's successes for the remainder of the season.",
                        "With performances like these, fans can expect exciting football throughout the rest of the campaign."
                    ],
                    basketball: [
                        "The team's chemistry and execution tonight bodes well for their conference tournament hopes.",
                        "Both squads showed the depth and talent that will serve them well in upcoming league play.",
                        "Tonight's game demonstrated the competitive balance that makes this conference so exciting."
                    ],
                    soccer: [
                        "The tactical lessons learned tonight will be valuable preparation for the upcoming playoff push.",
                        "Both teams displayed the skill and determination that defines competitive high school soccer.",
                        "With matches like these, the remainder of the season promises continued excitement for fans."
                    ],
                    baseball: [
                        "The pitching and hitting displays tonight showcase the talent level in this competitive league.",
                        "Both teams will build on tonight's performance as they continue their push toward the postseason.",
                        "Games like these remind us why high school baseball remains such a beloved community tradition."
                    ],
                    volleyball: [
                        "The teamwork and communication on display tonight will serve both teams well moving forward.",
                        "Tonight's match demonstrated the high level of volleyball being played in this conference.",
                        "Both squads showed the resilience and skill that will be crucial in upcoming tournament play."
                    ],
                    track: [
                        "Tonight's performances set high standards for upcoming invitational meets.",
                        "The dedication and training evident tonight will serve these athletes well at regionals.",
                        "Performances like these showcase the growing strength of the track and field program."
                    ]
                };
                return conclusions[sport] || conclusions.general;
            }

            copyArticle() {
                const text = this.articleContent.innerText;
                navigator.clipboard.writeText(text).then(() => {
                    this.copyBtn.textContent = '✅ Copied!';
                    setTimeout(() => {
                        this.copyBtn.textContent = '📋 Copy Article';
                    }, 2000);
                }).catch(() => {
                    // Fallback for browsers that don't support clipboard API
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    this.copyBtn.textContent = '✅ Copied!';
                    setTimeout(() => {
                        this.copyBtn.textContent = '📋 Copy Article';
                    }, 2000);
                });
            }

            emailArticle() {
                const title = this.eventTitle.value.trim() || 'Sideline Reporter Article';
                const text = this.articleContent.innerText;
                
                // Create email content
                const subject = encodeURIComponent(`Article: ${title}`);
                const body = encodeURIComponent(`Hi,

I've written a new article using Sideline Reporter:

${title}

${text}

Best regards,
Sideline Reporter Team`);
                
                // Create mailto link
                const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
                
                // Try to open email client
                try {
                    window.location.href = mailtoLink;
                    this.emailBtn.textContent = '✅ Email Opened!';
                    setTimeout(() => {
                        this.emailBtn.textContent = '📧 Email Article';
                    }, 3000);
                } catch (error) {
                    // Fallback: Copy email content to clipboard
                    const emailContent = `Subject: ${title}\n\n${text}`;
                    navigator.clipboard.writeText(emailContent).then(() => {
                        alert('Email content copied to clipboard! Paste it into your email app.');
                        this.emailBtn.textContent = '📋 Email Copied!';
                        setTimeout(() => {
                            this.emailBtn.textContent = '📧 Email Article';
                        }, 3000);
                    });
                }
            }

            saveToGoogleDrive() {
                const title = this.eventTitle.value.trim() || 'Sideline Reporter Article';
                const text = this.articleContent.innerText;
                const timestamp = new Date().toLocaleString();
                
                // Create Google Docs content
                const docContent = `${title}

Generated: ${timestamp}
Created with: Sideline Reporter App

${text}`;
                
                // Try Google Drive integration
                this.driveBtn.textContent = '⏳ Opening Drive...';
                
                try {
                    // Method 1: Try Google Docs direct creation
                    const encodedContent = encodeURIComponent(docContent);
                    const googleDocsUrl = `https://docs.google.com/document/create?title=${encodeURIComponent(title)}&content=${encodedContent}`;
                    
                    // Open Google Docs in new window/tab
                    const driveWindow = window.open(googleDocsUrl, '_blank');
                    
                    if (driveWindow) {
                        this.driveBtn.textContent = '✅ Drive Opened!';
                        setTimeout(() => {
                            this.driveBtn.textContent = '💾 Save to Drive';
                        }, 3000);
                        
                        // Show instructions
                        setTimeout(() => {
                            alert('Google Docs opened! Copy and paste your article content into the new document.');
                        }, 1000);
                    } else {
                        // Fallback if popup blocked
                        this.showDriveInstructions(title, docContent);
                    }
                } catch (error) {
                    this.showDriveInstructions(title, docContent);
                }
            }

            showDriveInstructions(title, content) {
                // Copy content to clipboard and show instructions
                navigator.clipboard.writeText(content).then(() => {
                    this.driveBtn.textContent = '📋 Content Copied!';
                    setTimeout(() => {
                        this.driveBtn.textContent = '💾 Save to Drive';
                    }, 3000);
                    
                    const instructions = `
Article content copied to clipboard!

To save to Google Drive:
1. Go to drive.google.com
2. Click "New" → "Google Docs"
3. Paste your article (Ctrl+V / Cmd+V)
4. Save with title: "${title}"

Or use the alternative method:
1. Go to docs.google.com
2. Create new document
3. Paste your content
                    `;
                    
                    alert(instructions);
                }).catch(() => {
                    // Last resort: Show manual instructions
                    alert(`
To save your article to Google Drive:

1. Copy your article text from above
2. Go to drive.google.com
3. Click "New" → "Google Docs"  
4. Paste your article
5. Save as: "${title}"

Your article is ready to copy from the screen above.`);
                    
                    this.driveBtn.textContent = '💾 Save to Drive';
                });
            }
        }

        // Initialize the hybrid app
        const app = new HybridSidelineReporter();
    </script>
</body>
</html>
